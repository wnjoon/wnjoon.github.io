---
layout: post
title:  "0x 프로토콜(protocol)" 
excerpt: "여러 거래소에서 erc20을 거래할 수 있는 공통 프로토콜인 0x 프로토콜에 대해 알아본다."
date:   2021-11-04 15:00:00 +0900
categories: blockchain
tags: [ethereum, 0xprotocol]
---

<br>

## 0x 프로토콜이란?

0x 프로토콜은 거래소의 탈중앙화를 위해 erc20 거래에 사용할 수 있는 공통된 프로토콜을 만들고자 하는 니즈에서 출발했다. 코인의 거래가 활발해짐에 따라 반번하게 발생하는 거래소를 겨냥한 DDoS 공격 또는 해킹을 해결하기 위함이다.  
0x 프로토콜은 스마트컨트랙트로 작성되어 이더리움 위에서 돌아간다. 코스모스나 비트쉐어처럼 중간자를 경유하지 않고도, 0x 프로토콜을 사용하면 직접 이더리움 토큰을 입금하고 거래할 수 있게 된다.

<br>

## 탈중앙화 거래소(DEX)와 문제점

DEX는 탈중앙화 거래소를 뜻하는 말로, 거래소를 거치지 않고 각 개인의 지갑만으로 직접적인 거래가 가능하다. 즉 블록체인 안에서 모든 거래가 가능하게 되는데, 이러한 특징으로 인해 비용 문제가 반드시 따라올 수 밖에 없다.  
이더리움에서는 모든 거래에 수수료가 부과된다. 수수료의 방식과 가격에는 차이가 있지만, 어찌되었든 반드시 부과되는 수수료의 특성 상 DDoS와 같은 공격이나 해킹으로부터 네트워크를 방어할 수 있게 된다. 하지만 수수료는 네트워크의 안전을 위해서는 장점일 수 있으나, 블록체인에서 모든 거래가 진행되는 DEX에게는 단점이 될 수 있다.  
일반적인 거래소 기반의 시스템은 내부에 수많은 단계를 거쳐서 코인을 거래하는데, 이를 블록체인으로 옮겨오게 되면 결국 각 단계마다 수수료가 부과되게 된다. 또한 거래의 결과가 반드시 블록에 쌓이기 때문에, 블록을 생성하면서 추가되는 시간 또한 무시하지 못하게 된다.  
이러한 문제점 때문에 DEX에서 제공하는 보안성과 거래소로부터의 탈중앙화와 같은 장점들을 뒤로하고 수많은 사용자들이 금전적, 시간적인 비용의 문제로 인해 거래소를 사용하고 있었고, 이를 해결하기 위해 0x 프로토콜이 제안되었다.

<br>

## 동작 방식

![](https://user-images.githubusercontent.com/39115630/140250276-8add59e5-7f7b-4771-b9aa-5cf567b9e628.png)  
*@그림 1: 0x 프로토콜의 동작 방식 1 - 출처: 백서*

위의 그림을 단계별로 설명하면 아래와 같다. 
1. Maker가 이더리움 네트워크에서 DEX로 토큰A를 입금한다.
2. Maker는 토큰A와 토큰B를 거래한다는 메시지를 별도의 중개자(Relayer)에게 전송한다. 중개자는 이더리움 네트워크 밖에 위치한다.
3. 중개자는 Maker로부터 받은 메시지를 전파한다.
4. Taker는 중개자가 전파한 메시지를 받아 해당 주문(Order)을 사용한다.
5. Taker는 이더리움 네트워크에서 DEX로 토큰B를 입금한다.
6. Maker는 DEX에 자신의 메시지를 전송하고 주문 처리를 요청한다.
7. DEX는 서명과 만료일 등의 조건을 확인하고, Maker와 Taker간 토큰을 교환한다.

체인과 오프체인(off-chain) 관점에서 위의 과정을 다시한번 확인해보면 아래와 같다.
- off-chain: 2,3,4의 과정으로, 가상화폐의 교환이 일어나기 전 과정(주문 생성, 확인, 거래 요청)을 포함한다.
- on-chain: 1,5,6,7의 과정으로, 탈중앙화된 환경(이더리움)에서 거래 체결 및 트랜잭션을 발생하는 과정을 포함한다. 

Binance 앱에서는 Orderbook을 통해 가격을 설정하고 구매(buy)/판매(sell)를 선택하는 행위를 off-chain에서 진행하고, 만들어진 실제 order에 대한 거래를 처리하고 토큰A가 토큰B로 변환되어 잔고가 변경되는 과정이 on-chain에서 진행된다. 이를 그림으로 표현하면 아래와 같은데, 여기서 말하는 수수료로 0x 프로토콜에서 만든 ZRX가 사용된다.

![](https://user-images.githubusercontent.com/39115630/140251868-67b5189e-3b25-45a4-9ccf-4790e8fca277.png)  
*@그림 2: 0x 프로토콜의 동작 방식 2 - 출처: Steemit*

1. 중개자가 판매자와 구매자 각각에게 수수료를 제시한다.
2. 판매자는 오더북에 어느 정도의 가격으로 올릴지 중개자에게 요청한다.
3. 중개자는 오더북에 판매자의 요청 가격을 등록한다.
4. 구매자는 오더북을 보고 마음에 맞는 가격일 경우 구매를 진행한다.
5. 최종적으로 확정된 거래가 이더리움 내에 등록된다.

<br>

## 정리

동작 방식에서 볼 수 있듯이, 0x 프로토콜은 off-chain과 on-chain을 섞은 '하이브리드' 방식을 추구한다. 중개자라는 이더리움 외부의 별도 시스템을 off-chain으로 이용하기 때문에 보안성이 취약할 수 있다는 우려를 낳기도 하지만, 실제 중개자가 처리하는 메시지는 오로지 암호화된 주문 내역이기 때문에 중개자에 대해 꼭 신뢰할 필요가 없게 된다.   
추가로 고의로 메시지를 처리하지 않고 악용할 수 있다는 우려를 해결하기 위해, 0x 프로토콜은 각 주문 별로 만료일이라는 값을 둔다. 만료일이 지나면 해당 주문은 무효화 처리 된다.

<br>

## 참고자료
- [0x Protocol white paper](https://0x.org/pdfs/0x_white_paper.pdf)
- [뉴비의 백서리뷰 - 제로엑스(ZRX)](https://steemit.com/blockchain/@kukubu/zrx)
- [제로엑스 프로토콜 DEX 원리, 간단 이해하기](https://steemit.com/coinkorea/@prosong77/0x-protocol-dex)
- [0x란? 탈중앙 거래소를 위한 새로운 거래 프로토콜](https://steemit.com/kr/@mossid/0x)