---
layout: post
title:  "이더리움에서 가스의 역할" 
excerpt: "가스는 목표 해시 값을 계산해 낸 채굴자에 대한 보상으로 제공되는 수수료를 의미하는데, EVM 상에서 트랜잭션을 동작시키기 위한 필수적인 비용으로 생각하는게 더 편하다. 하루에도 수없이 가격이 바뀌는 이더의 가격으로 수수료를 매기는 잘못된 방법을 피하기 위해, 이더리움에서는 일정한 가격을 가진 가스라는 단위를 만들어서 사용한다."
date:   2022-10-25 15:00:00 +0900
categories: blockchain
tags: [ethereum]
---

<br>

## 가스는 왜 필요한가

이더리움에서 가장 신경쓰이는 개념을 꼽으라면 당연히 가스일 것이다. 가스는 목표 해시 값을 계산해 낸 채굴자에 대한 보상으로 제공되는 수수료를 의미하는데, EVM 상에서 트랜잭션을 동작시키기 위한 필수적인 비용으로 생각하는게 더 편하다.


![](https://miro.medium.com/max/720/1*mI8hVfDXdLMWsw89zzdjvg.png)  
*@그림 1 : 기능 별로 필요한 가스의 개수(량) - yellow paper*


이더리움은 [황서(yellow paper)](https://ethereum.github.io/yellowpaper/paper.pdf)를 통해 실행되는 코드 별 필요한 가스량을 명시해두었다. 사실 이더리움이 아닌 일반적인 시스템에서도 기능에 따라 필요한 자원량이 달라진다. 예를 들어, 간단한 워드 작업이나 인터넷 서핑은 큰 자원을 요구하지 않지만, 고사양의 게임을 하거나 동영상을 인코딩 하는 작업 등에서는 꽤 많은 자원이 필요하다.

<br>

## 왜 이더를 그래도 사용하지 않고 가스를 따로 만들었을까?

![](https://velog.velcdn.com/images/wnjoon/post/4e5ede64-9598-4a25-b50b-b1c8c533ebd9/image.png)  
*@그림 2 : 하루 동안 변화된 이더리움 가격*

결론부터 말하면, 이더는 시장가격이 변동되는, unstable한 코인이기 때문이다. 위의 그림처럼 하루에도 수없이 가격이 바뀌는 이더의 가격으로 수수료를 매기는 잘못된 방법을 피하기 위해, 이더리움에서는 일정한 가격을 가진 가스라는 단위를 만들어서 사용한다. 수수료는 이와 같이 가스의 갯수에 따라 표현된다.

<br>

## 가스비의 단위

그럼 가스비는 이더로 표현되는가? 아니다. 가스비는 Gwei라는 단위로 표현된다.

![](https://legacy.ethgasstation.info/blog/wp-content/uploads/2019/06/Selection_138.png)  
*@그림 3 : 이더의 세부 단위*

결국 그림 3을 기준으로 정리해보면 아래와 같다.

> 1 Eth = 1,000,000,000 Gwei = 1,000,000,000,000,000,000 Wei

<br>

## 가스비와 수수료는 같은 것인가?

먼저 많은 사람들이 헷갈리는 부분을 정리하면, 위의 그림 1에서 기능 별로 적혀있는 가스는 '가스의 갯수(량)'이다. 그렇기 때문에 실제로 부과되는 수수료는 아래와 같다.

> 수수료 = 사용되는 가스의 총량 x 가스비

결국 거래를 일으키는 유저는 위의 가스비(gas price)를 설정하여 총 수수료를 계산하게 된다. 그리고 채굴자들은 수수료가 낮은 순으로 거래를 완료시키기 때문에, 결국 가스비는 거래가 완료되는데 걸리는 시간에 영향을 주게 된다.

정리하면,
- 가스비: 1gas 당 매겨지는 이더량
- 수수료: 해당 거래(트랜잭션)를 완료하기 위해 필요한 총 이더량
이 된다.

그럼 만약 1 gas를 30 Gwei라고 한다면, 이더 송금에 사용되는 수수료는 얼마가 될까? 그림 1의 황서를 기준으로 'paid for every transaction'이 21000 이기 때문에, 총 수수료는 아래와 같다.

> 수수료 = 21000 * 30 = 630,000 Gwei = 0.00063 Eth

조금 더 자세한 예시로 이해하고 싶다면, [GAS의 개념과 이해, 매커니즘 정리](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=mage7th&logNo=221440430723)의 '2.Gas 개념 이해를 위한 예시'를 참조하면 좋다.

<br>

## 얼마의 가스비가 적정한 가격일까?

가스비는 이더리움 지갑에서 설정하게 되는데, 적정 수수료는 아래와 같은 방법으로 알아보면 좋다.

1. [이더스캔](https://etherscan.io/)에서 비슷한 다른 트랜잭션을 찾아본다.
2. [ETH gas station](https://ethgasstation.info/)에서 적정 가스비를 확인한다. 

결국 가스비가 높아지면 수수료가 높아지니 채굴자가 더 빠르게 처리하겠지만, 그 중 가장 적절한 가격을 선택하는 것이 중요해진다. 그렇다면 가스비는 무작정 높게 측정할 수 있는것일까? 정답부터 말하면, 가스한도라는 것이 존재한다.

<br>

## 가스한도(gaslimit)의 필요성

가스비와 별개로, 가스한도는 거래를 일으키는 사용자가 본인이 최대로 사용할 가스 량을 정해놓는 것을 말한다. 중요한 것은 가스비를 정하는 것이 아닌, 가스량을 정하는 것이다. 그러므로 지갑에서는 지불할 용의가 있는 수수료를 이더 형태로 계산하여 이를 트랜잭션에 담아 보낸다.

> 지불할 용의가 있는 최대 수수료 = gas limit(가스량) x gas price(가스비)

만약 지불 가능한 수수료의 양보다 더 많은 수수료가 들어간다면 어떻게 될까? 지불 가능한 수수료를 넘어가는 순간 컨트랙트의 실행은 멈추고 초기 상태로 돌아간다. 그때까지 실행된 모든 상태는 다시 원상복귀되고, 사용 중이던 수수료 또한 트랜잭션 발생자에게 돌아간다.

그렇다면 지불 가능한 수수료의 양보다 적은 수수료로 트랜잭션이 완료되었다면 어떻게 될까? 남은 이더는 트랜잭션 발생자에게 환급되어 돌아간다.

> gasprice가 30이고 gaslimit을 30000으로 설정한 트랜잭션이 9000만큼의 가스를 남기고 완료되었을 경우 -> 9000 x 30 = 270000 Gwei 만큼의 수수료가 환급됨

그러므로 <u>gas limit은 최대한 넉넉하게 잡아야 트랜잭션이 반환되는 일을 방지</u>할 수 있다. 

<br>

## 채굴자에게는 가스한도가 어떤 영향을 줄까?

채굴자에게는 블록가스한도(Block gas limit)이라는 개념이 중요한데, 이는 블록 하나에 담을 수 있는 gas limit(가스량)을 의미한다. 

이더리움은 기본적으로 한 블럭 당 4,712,357 개의 가스를 담을 수 있도록 되어있다. 일반적인 이더 전송의 경우 가스 한도가 21000이기 때문에, 대략 224개의 트랜잭션을 하나의 블록에 넣을 수 있다. 

> 이더리움에서 블록은 PoW의 경우 생성에 15초에서 20초 정도 걸렸으며, 최근 머지를 통해 변경된 PoS에서는 대략 11초 정도 소요된다고 한다. 

<br>

## 참고자료

- [Ethereum - Yellow paper](https://ethereum.github.io/yellowpaper/paper.pdf)
- [GAS의 개념과 이해, 매커니즘 정리 - 야옹메롱](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=mage7th&logNo=221440430723)
- [What is Gwei?](https://legacy.ethgasstation.info/blog/gwei/)